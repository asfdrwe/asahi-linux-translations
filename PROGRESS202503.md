[Progress Report: Linux 6.14](https://asahilinux.org/2025/03/progress-report-6-14/)の非公式日本語訳です。

訳注 
- 関連する文書へのリンクは対応する日本語訳へのリンクに変更
- [マイクのビームフォーミングの関する参考資料](https://www.ieice-hbkb.org/files/02/02gun_06hen_02.pdf)

---
# 進捗報告: Linux 6.14

- [前回](https://github.com/asfdrwe/asahi-linux-translations/blob/main/PROGRESS202502.md)

3月が終わりを迎え、Linux 6.14のリリースが近づく中、[プロジェクトのリードを引き継いで](https://github.com/asfdrwe/asahi-linux-translations/blob/main/PROGRESS202502.md)以来、初めての大きな進捗報告を皆さんに提供する良いタイミングがやってきました。
今後は、これらの更新をアップストリームのカーネルリリースに同期させていくことを目指します。
上流への注力を考えると、これが自然なペースであり、投稿の間に注目すべき下流の変更が十分に蓄積される時間があると感じています。
marcan氏の退任後に必要なすべての事務作業をこなし、プロジェクトを継続させるための基盤を整えた後、私たちは上流へのパッチ提出を本格的に開始しました。
興味深い状況下で初の理事会会議を開催し、みなさまが気づかないうちに上流ににいくつかの新機能をこっそり追加することにも成功しました。それでは、早速本題に入りましょう。

## 初の理事会会議
2月7日に初めて理事会会議を開催しましたが、一部メンバーにとっては厳しい状況でした。
Neal氏とDavide氏はサザンカリフォルニアLinuxエキスポで貧弱な会議場のWiFiと格闘し、私はトロピカルサイクロン・アルフレッドがクイーンズランド南東部とニューサウスウェールズ北部を襲う中、停電で暗闇に座っていました。それでも、かなりの議題をこなすことができました。会議の議事録は[こちら](https://asfdrwe.github.io/asahi-linux-translations/project/board/minutes/20250307/)で確認できます。

## 負担の軽減
4年間の開発を経て、かなりのパッチセットを蓄積してきました。以下はいくつかの簡単な統計です：

- Linuxカーネル6.13時点で1250のパッチにわたり9万行以上のコードを追加
- 下流のU-Boot: Apple SiliconおよびUSBスタックの修正を多数含む
- 下流のMesa: GPU uAPIがまだ上流に統合されていないため必要
- 下流のvirglrenderer: GPU uAPIがまだ上流に統合されていないため必要
- 下流のFlatpakランタイム拡張: 下流のMesaのために必要

これは…理想的とは言えません。私たちのフォークのリベース、テスト、リリースは時間のかかる大きな負担です。
特にJanne氏にとっては、カーネルパッチセットを上流に適用し続け、すべての安定ポイントリリースに移植するという賽の河原(Sisyphean task)のような作業があり、Rust抽象化の上流が進むにつれてほぼ毎週何時間もの作業が必要となっています。
これを続けることはできません。

M3とM4への対応、Thunderbolt、DisplayPort Alt Mode、可変リフレッシュレート、HDR、ハードウェアアクセラレーテッドビデオ再生、そしてPro/Max/Ultra Mac向けのより優れた電源管理をお届けしたいと考えています。
ですが、そのためには下流で持ち続けるパッチの量を減らし始めなければなりません。私たちが持ち続けているもののほとんどは何年も安定しているのですよ。
では、1か月のたゆまぬ努力の結果、どうなったのでしょうか？

3つの新しいドライバを上流に提出しました。
ウェブカメラ対応に必要な画像処理プロセッサ（Image Signal Prosessor, ISP）ドライバと、タッチバーのディスプレイコントローラおよび入力デジタイザ用のドライバです。
これら3つのドライバは合計で約8000行のコードに及び、ISPドライバだけで6000行を占めています。
良いニュースは、タッチバーの両ドライバがもう受け入れられたことです！
chaos_princess氏に感謝します。責任を持ってこれら3つすべてを準備し提出していただけました。
Alyssa氏とJanne氏はGPUドライバを提出に向けて整理する作業に頑張っていました。
これにはuAPIにいくつかの変更が含まれます。一部のワークロードのパフォーマンスが若干向上するでしょう。

Rust for Linuxの抽象化が健全なペースで統合され始めている今、新たな課題に直面しています。
カーネルパッチがメーリングリストを通過する際に少なくともいくつかささいでない変更なしに進むことは稀であり、Rust抽象化も例外ではありません。
ドライバが使用する抽象化がマージされるたびに、下流のバージョンを削除し、上流で受け入れられたバージョンにドライバをリベースする必要があります。
これは過酷で単調かつ不愉快な作業であり、Janne氏がその時間をボランティアで提供してくれたことに深い感謝を表します。

カーネルの他の部分の整理と上流化にも取り組んできました。
NVMeやI2Cコントローラなど、すでに上流に統合されているドライバに対する多くの雑多な修正や変更に加え、Apple Silicon Macに搭載されているApple特有のバリエーションを対応するように、上流のTexas Instruments TAS2764およびTAS2770スピーカーアンプドライバへの変更も提出しました。
このプロセスを通じて、ASoCメンテナがすでに私たちの開発ブランチから一部のコミットをチェリーピックしていることがわかりました！

まだ終わりには程遠いですが、この重要な作業をやり遂げることに全力を尽くしています。
さらに多くのパッチが随時提出されているので、この状況に注目してください！

## これは動いていますか？

これを読んでいる頃には、ほとんどのラップトップでマイクサポートを有効にしているでしょう！
これはずっと待ち望まれていたものでス。Martin Povišer氏、Eileen Yoon氏、そしてchaos_princessがかなり前にRustでAlways-On Processor（AOP）のドライバをリバースエンジニアリングし開発していました。しかし、Appleのことです。決して簡単ではありません。

Linuxでマイクを扱う前に、まず障害にぶつかりました。特定のマシンでは、物理的なマイクデータラインの経路上にSecure Enclave（SEP）が存在します。
SEPが満足していないと、マイクにアクセスできません。
chaos_princess氏はすぐに担当のSEPエンドポイントをリバースエンジニアリングし、ハードウェアのマイクスイッチを単純にオンにするスタブドライバを書きました。
これで全マシンでデータがALSAに流れ込むようになり、先に進むことができました。

これまでにリリースされたすべてのラップトップで、Appleは3つのPulse Density Modulation（PDM）マイクを使用しており、AOP内のADCとデシメータに接続されています。
3つのマイクすべてがプリアンプなしで別々のチャンネルとして直接ユーザースペースに送られます。3つのマイクがあることで、Appleはビームフォーミングを使用できます。
これは、センサーアレイの指向性と感度を大幅に向上させる信号処理技術です。
元々はレーダーや軍事通信のために開発されたものですが、今ではWiFiアクセスポイントのマーケティングポイントとして知られています。
そしてそれは本当に、本当に、本当に難しいのです。

残念ながら、PDMマイクは全指向性がとても強く非常に敏感です。
ビームフォーミングなしではどうにもなりませんでした。
最初、高度な信号処理を必要としない非常に基本的な遅延・加算ビームフォーマーを試しました。
しかし、マイク間の距離が約2cmしかなく、サンプリングレートが48kHzしかないため、この方法で必要な時間分解能を得ることができませんでした。
やはり信号処理が必要ですね。

音響領域での信号処理の神秘を本当に理解している人はごくわずかです。
このテーマに関するわずかな文献と高校の数学の教科書を参考にした後、これをうまくやる希望が全くありませんでした。
Mastodonで助けを求める呼びかけをしましたが、誰も名乗り出てくれませんでした。
仕方ない、自分がやるしかないです。

さらにいくつかの論文を読んだ後、自分にとって馴染みのあるアプローチを見つけました。
Minimum Variance Distortionless Response（MVDR）ビームフォーマーは、時間領域の複素サンプルデータを取得し、固定点（通常はアレイ内の特定のマイク）に対して特定の方向に重み付けされた最適化技術を使用します。
ある時点で、これが実は統計学にすぎないと気づきました！

Rustの未熟な科学計算ライブラリと数週間格闘し、高校の数学と大学の統計学の教科書をさらに読み込んだ結果、[Triforce](https://crates.io/crates/triforce-lv2()が生まれました。
これはAppleラップトップのマイク向けのMVDRビームフォーマーです。

PipeWireとWirePlumberでスピーカー対応のために築かれた基盤のおかげで、Triforceを含むマイクのDSPチェーンを接続するのは本当に簡単でした。
設定ファイルを更新するだけで、後はWirePlumberがすべてを処理してくれました！

うまくいきましたか？Rustなので、初回から動きました！
適切に調整すれば、マイクアレイはラップトップの前の『典型的な』座席位置からの信号に敏感になり、他の方向からのノイズをほぼ拒否します。
お試しください。携帯電話で音楽を再生し、ラップトップの周りを動かしてみてください。
側面や背後に移動すると音が抑えられるはずです。

改めて、Martin氏、Eileen氏、そしてchaos_princess氏に、AOPとSEPのリバースエンジニアリングにおける素晴らしい仕事に心からの感謝します。

## Fedora Asahi Remix 42 Beta

Davide氏 のビルド検証作業のおかげで、Fedora Asahi Remix 42 がベータ版として[利用可能](https://fedoramagazine.org/announcing-fedora-asahi-remix-42-beta/)になりました！
最終リリースは約1か月後に予定されており、これまで以上に Fedora との同時リリースに近づいています。
次のサイクルでは、Fedora Asahi Remix 43 が Fedora Linux 43 と同日にリリースされることを願っています。

## Asahi Linux @ SCaLE
[SCaLE](https://www.socallinuxexpo.org/scale/22x)で、Neal 氏と Davide 氏は展示ホールで M2 Mac mini と M1 Mac Studio 上で Asahi Linux を動作させるデモンストレーションを成功させました。
反応は非常に好評で、参加者は muvm と FEX を通じて多くの Steam ゲームを楽しんでいました。
特に子供たちには『Nidhogg』が大人気で、イベントで最も注目されたゲームとなりました。

## WoAoA（Windows on ARM on Asahi）
鋭いユーザーの一部は、ARM64 Windows 仮想マシン（VM）が Asahi 上で KVM を使って動作することに気づいたかもしれません。
これは、Oliver Upton氏 が Apple SoC 上での Arm PMUv3 エミュレーションを可能にする大規模なパッチシリーズをアップストリームに提出したおかげです。
Windows on ARM（WoA）は PMUv3 を必要としますが、これまでエミュレーションができませんでした。
そのパッチを静かに取り込み、最新のカーネルに組み込みました。
興味のある方は、今日から Asahi 上で Windows on ARM を試すことができます！

## Feature Level について dxdiag の表示
Feature Level は 12_0 です！
Alyssa 氏が最近 Vulkan ドライバにスパースバインディングへの対応を追加したことで、vkd3d-proton を介して Direct3D Feature Level 12_0 が実現しました。
これにより、最新の Mesa と FEX rootfs を使って、さらに多くの D3D12 ゲームが動作するようになりました。
Vulkan ドライバは OpenGL ドライバほど成熟していないため、パフォーマンスやプレイアビリティにはバラつきがありますが、近日中の最適化が予定されています。

## マジックペアリング
Apple Silicon Mac には、BluetoothデバイスがすべてのmacOSインストール（recoveryOSを含む）間で同期される便利な機能があります。
デバイスをペアリングするために必要な情報は、マシンのNVRAMに保存されています。
macOSはNVRAMを確認し、自分が知らないデバイスのデータをコピーします。
どのmacOSインストールが起動されていても、同じBluetoothコントローラを見ているため、デバイスは再度ペアリングプロセスを経ることなく自動的に接続します。
これは特にrecoveryOSを含むすべての環境でBluetoothキーボードやマウスがシームレスに動作するのに非常に役立ちます。

Linuxでこの機能を再現するために、Janne氏は[asahi-btsync](https://crates.io/crates/asahi-btsync)を開発しました。
このツールはNVRAMからBluetoothデバイスの情報を読み取り、BlueZの設定に注入します。
数週間前までは、このプロセスは手動で実行する必要があり、asahi-btsyncを実行して見つかったデバイスに手動で接続しなければなりませんでした。
これは、これらの操作に必要な入力デバイスにとっては実用的ではありませんでした。

バージョン2.4以降、asahi-btsyncはsystemdとD-Busと統合され、Bluetoothデバイスの同期プロセスを完全に自動化しました。
Fedora Asahi Remix 42から、macOSでペアリングされたすべてのBluetooth LEデバイスが初回起動時から利用可能になります。これにはFedora Asahi Remixの初期セットアップも含まれます！

ただし、これはBluetooth 5.0デバイスには適用されない点に注意してください。Bluetooth 5.0デバイスは新しい認証および暗号化スキームを使用しているためです。

## OpenCollectiveとGitHub Sponsors
[OpenCollective](https://opencollective.com/asahilinux)を立ち上げたとき、正直なところ何を期待すべきか誰もわかりませんでした。
ドメインやCDNを維持するのに十分な支援が集まればいいなと願っていましたが、それ以上は期待しないようにしていました。

しかし、支援の量とそのスピードには圧倒され、言葉では表現しきれないほど謙虚な気持ちになりました。
皆さんの私たちの仕事への信頼は言葉以上に意味があり、本当に感謝しきれません。

OpenCollective を通じて提供された財政的支援のおかげで、私たちは自信を持って仕事を続けることができます。
既存のプロジェクトインフラをオンラインに保つために必要な資金だけでなく、プロジェクトの長期的な存続を確保するためにずっと欲しかったリソースも手に入りました。

これまでは、主に自分たちのポケットマネーでマシンを購入してきました。
私たちの活動の性質上、年間1万ドル以上をMacに費やすこともあります。
これは個人レベルで持続不可能なだけでなく、高価なコンピュータを購入する余裕がない才能ある人々にとって大きな参入障壁でもあります。
OpenCollectiveの支援者からの財政的サポートにより、その経済的負担を大幅に軽減できます。
これは開発作業においてすでに非常に貴重なものとなっています。

M1 MacBook Airは、約14,000台以上のインストール数を誇り、断トツで最も人気のあるMacです。
これは全インストールベースの約30%を占めています。このモデルに対応せずにマイク機能をリリースすることは考えられませんでした。
マシンを購入して、次の2週間の食費を心配せずに作業を進められることが、マイク機能をタイムリーにリリースできた唯一の理由です。

ハードウェアの購入だけが、みなさまの財政的支援によって得られた革新的な利点ではありません。
これまで何年も必要としていたCIファームを構築・維持できるようになり、開発が加速します。
メールホスティングや摩擦を大幅に減らすその他の協働インフラも賄えます。
財政的ストレスを恐れずにカンファレンスやイベントに参加することもできます。
これらはすべて、Asahiプロジェクトの長期的な持続可能性を確保するために必要であり、みなさまなしでは実現できませんでした。

GitHub Sponsorsを通じて支援を希望する方のために、現在準備を進めています。
GitHubにSponsorsアカウントをOpenCollectiveにリンクするリクエストを提出しましたが、まだ承認されていません。続報をお待ちください。

## 次は何でしょうか？
この1か月は、私にとって文字通り嵐のようなものでしたが、しばらくしてうまく機能するリズムに落ち着き始めました。
主な焦点は、カーネルパッチを上流に提出し続けることです。
メンテナンス負担を減らすことが、楽しいことに持続的に戻るための唯一の方法です。

Neal氏とDavide氏は、5月19日に開催されるRed Hat Summitで、Fedora Asahi Remixと近日中のCentOS Hyperscale Asahi Remixをデモンストレーションし、Asahiが開発者にとってARM64 Linuxにワークロードを持ち込むのをこれまで以上に簡単にしていることを示すでしょう。

Linux 6.15がリリースされる時には、さらに良いニュースをお届けできることを願っていますので、今後の更新にご期待ください！
改めて、これまで支援してくださったすべての方々に心から感謝申し上げます。

#### James Calligeros - 2025-03-21

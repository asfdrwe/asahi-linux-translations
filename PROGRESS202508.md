[Progress Report: Linux 6.16](https://asahilinux.org/2025/08/progress-report-6-16/)の非公式日本語訳です。

訳注:

- Asahi Linux 文書へのリンクは対応する日本語訳へのリンクに置き換え

---
# 進捗報告: Linux 6.16

- [前回](https://github.com/asfdrwe/asahi-linux-translations/blob/main/PROGRESS202505.md)

Linux 6.16が公開され、また進捗報告の時間がやってきました！前回お伝えしたように、Asahi Linuxと Honeykrisp 氏の Mesa ドライバがようやく上流に取り込まれました。
これにより GPU　関連の作業が活発化したので、まずはそこから始めていきましょう。

## Flatpak に足りないナッツはありません
長い間、Flatpak ランタイム用にビルドした Mesa ドライバのバージョンを維持し、Flatpak ランタイムの拡張機能として公開してきました。これは、Mesa ドライバが
上流で有効になっていないうちは、Flatpak で GPU アクセラレーションを可能にするために必要でした。Flatpak ランタイムバージョン23.08が今月でサポート終了となるので、
もう必要なくなります。Flatpak ランタイムバージョン 24.08 は Mesa 25.1 を搭載しており、近日公開予定の 25.08 ランタイムも同様です。25.08 がリリースされると、
Flatpak ランタイムの拡張機能は不要になるため、廃止します。

## *完全に上流の*グラフィックスタック
Asahi Linuxは、GPU を準仮想化(訳注:[paravirtualizaion](https://ja.wikipedia.org/wiki/%E6%BA%96%E4%BB%AE%E6%83%B3%E5%8C%96))するために DRM Native Context を
使用しています。DirectX や Vulkan のような高レベルの API を仮想化する代わりに、VM はホストのネイティブ GPU ドライバのユーザースペースコンポーネントを実行します。
ホストは、ネイティブGPUコマンドを受け取り、変更せずにカーネルに転送するだけです。これにより、
[Asahi Linux のゲーム用仮想マシン](https://github.com/asfdrwe/asahi-linux-translations/blob/main/PROGRESS202410.md) muvm 内の GPU パフォーマンスが向上します。
しかし、これまでは virglrenderer と Mesa の下流パッチに依存していました。

私たちの DRM Native Context の実装が上流の virglrenderer プロジェクトに統合され、上流の Mesa 25.2 で有効になることをお知らせでき、うれしく思っております！
これにより、完全に上流のグラフィックスタックへの移行が完了しました。Mesa のフォークは完全に廃止します。

## GPU がブーーーン
Mesa ドライバが完全に上流に統合されたことで、改善作業が急速に進んでいます。Alyssa 氏は過去数ヶ月間パフォーマンスの最適化に取り組んでいます。
[多数のマージリクエスト](https://gitlab.freedesktop.org/mesa/mesa/-/merge_requests/?sort=created_date&state=merged&label_name%5B%5D=asahi&author_username=alyssa)が
上流に取り込まれ、その大部分は Mesa 25.2 のリリースに間に合いました。パフォーマンスの向上はさまざまですが、FEX の JIT に対する
[今月の改善](https://fex-emu.com/FEX-2508/)と組み合わせると、相当良いものになりました。

## 素晴らしいヴィンテージ
また、Mesa 25.2 では、chaos_princess 氏のおかげで`VK_EXT_map_memory_placed`に対応しました。この Vulkan 拡張機能により、アプリケーションは GPU メモリを
特定のアドレスにマッピングするよう要求できます。WINE は 32 ビットの DXVK をサンクする際にこれを使用し、GPU ドライバによって割り当てられたメモリが 32 ビットのアドレス空間内に
あることを保証します。これは、32 ビットのWindowsアプリケーションでGPUアクセラレーションを有効にするために必要です。
どういうこと？32 ビットのゲームはすでに FEX で動作していますよ？あぁ… 

現在、ゲームを可能にするために出荷しているスタックはかなりのものです。一番下には muvm があり、（想像しているように）4K メモリページで設定されたカーネルを使用してマイクロ VM を起動します。
現在の FEX はこれを必要とします。x86 アーキテクチャは 4K ページしか対応しておらず、メモリページをより小さなページに『分割』することはできず、大きなサイズのページを作成するために
結合することしかできません(訳注: ほとんど使われていませんが 32bit x86 でも Pentium から追加された[Page Size Extension](https://en.wikipedia.org/wiki/Page_Size_Extension)で 4MB ページに対応し、Pentium Pro から追加された[物理アドレス拡張(Page Size Extension, PSE)](https://ja.wikipedia.org/wiki/%E7%89%A9%E7%90%86%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9%E6%8B%A1%E5%BC%B5)でも 2MB ページに対応しています。Linux 
ではこれらを利用して[32bit x86でも4Kページ以外に対応しています](https://qiita.com/akachochin/items/6e38f89f9421f3e7cbcf)(2025/8/12修正))。
その上には FEX があり、x86 バイナリを翻訳して 64 ビットの ARM 機器で実行できるようにします。しかし、バイナリアプリケーションは自己完結型の一枚板であることはほとんどありません。
システムコールを介してカーネル関数にアクセスしたり、glibc のようなシステムライブラリにアクセスしたり、Vulkan のような API を介して GPU にアクセスする必要があります。

明白な解決策 ーそしてFEXが使用している方法ー は、全体を変換することです。FEX が x86 または amd64 アプリケーションをロードすると、そのローダーは、アプリケーションのバイナリが
リンクされているライブラリを、multilib amd64のルートファイルシステムを含むディスクイメージもしくはマウントポイントから引き出し、変換します。ここでの利点は、実行したい
アプリケーションがリンクされているライブラリの ABI に合ったネイティブバージョンを使用できることです。しかしながら、欠点は重大です。

ディスクイメージには任意のアプリケーションが実際にリンクされる可能性のあるライブラリがすべて含まれている必要があります。アプリケーションの一部が単に動作しないことを受け入れるか、
使用しない可能性のある外国の機器用の巨大なライブラリでいっぱいのファイルシステムイメージを出荷するかです。また、ライブラリを翻訳したり、syscall　インターフェースを偽装したりするための
ランタイムコストもあります。これより良い方法があります。

エミュレーションスタックは、WINE/Proton　を介したゲーム目的で圧倒的に使用されています。単純化のために、x86 Linuxアプリケーションを実行することではなく、x86 Windows 
アプリケーション、特にゲームを実行することを目標だと言いましょう。

Arm 上の Windows のユーザーは、x86 アプリケーションを実行できることに気づくでしょう。今日の Windows NT の歴史の授業は省略しますが、NT チームの抽象化、移植性、
ほぼ40年にわたる後方互換性への宗教的な注視により、次の3つの非常に重要で有益な機能が提供されています。

- WoW64 32 ビットのシステムコールを 64 ビットのシステムコールに変換
- WoW64 にバイナリトランスレータを接続するための API
- 物理ページサイズに関係ない 64K の仮想メモリページ

WINE が WoW64 を実装し、FEX が WoW64 バイナリトランスレータ API を実装しているため、AArch64 WINEは32ビットのx86アプリケーションを実行できます。すべての Windows
アプリケーションには 64K ページが割り当てられるため、理論的にはページサイズを気にする必要はありません（これについては後で詳しく説明します）。`VK_EXT_map_memory_placed`により、
パズルのすべてのピースが揃いました。AArch64 WINE は、muvm *なしで* 32 ビットの Windows アプリケーションとゲームを実行できるようになりました！ 

- GPU、ネットワークアクセス、ファイルシステムを準仮想化することは不要
- X11やPipeWireプロトコルをいじったり、プロキシしたりすることは不要
- WINE は XWayland を強制されることなく直接 Wayland を使用可能
- FEX は x86 Windows コードを翻訳するだけで、WINE はネイティブの AArch64 64 ビット Windowsと *nix に呼び出す

とはいえ、効果はまちまちです… 

Windows が 64K の仮想メモリページを割り当てるのは事実ですが、すべてのアプリケーションがこれを尊重しているわけではありません。Windowsアプリケーションの開発者は、Windows API を
無視する長い伝統があり、特にゲーム開発者はパフォーマンスを追求して特に悪質な犯罪を犯しています。これはしばしば、4K の物理メモリページのような x86 固有のものをコードに組み込むことを
意味します。これを行うアプリケーションは単に動作せず、muvm の使用を必要とし続けます。ただし、muvm 内で WoW64 を使用できるようになり、これらのアプリケーションもほとんどの利点を
享受できます。

また、FEX や WINE のバグが予想されますが、2003年製の壊れた Windows アプリケーションとは異なり、これらは修正される可能性がかなり高いです。

自分で試してみたいですか？いくつかのディストリビューションでは、すでにシームレスになっています。chaos_princess 氏のおかげで、Gentoo は `wow64` USE flag が有効に
なっている場合、AArch64 システムに FEX の WoW 64実装を自動的にインストールします。`wow64` USE flagを有効にして好みの WINE フレーバーをインストールし、新しい WINE
プレフィックスを作成するだけで始められます！

他のディストリビューションでは、いくつかの追加作業が必要です。

1. ディストリビューションが WoW64 を有効にした AArch64 WINE をビルドしていることを確認。Fedoraでは現在そうではないが、近日中に利用可能に！
2. ネイティブのディストリビューションのパッケージを使用してWINEをインストール
3. [FEX Ubuntu PPA](https://launchpad.net/~fex-emu/+archive/ubuntu/fex/+packages) から最新の`fex-emu-wine`ビルドをダウンロード
4. `libwow64fex.dll`のみを`/usr/lib/wine/aarch64-windows/xtajit.dll`に展開
5. 新しいWINEプレフィックスを作成

WINEプレフィックスをすべて設定したら、x86 Windowsアプリケーションをはるかに改善された方法で楽しむことができます！

![LEGO Star Wars](https://asahilinux.org/img/blog/2025/08/lsw.png)
LEGO Star Wars (2005)をネイティブ AArch64 WINE で DXVK を使用して実行

amd64/x86_64/x64　アプリケーションはどうですか？残念ながら、AArch64 Windows　環境で　amd64 Windows　コードを実行する際の固有の課題があるため、このスタイルの
エミュレーションは　amd64 Windows　アプリケーションには対応していません。

![notepad](https://asahilinux.org/img/blog/2025/08/npp.png)

WINE の ARM64EC モードで実行中の AMD64 Notepad++

…まだです。

## そこに近づいています…
いつものように、さまざまな部分をupstreamに取り組んでいます。

GPU の Devicetree バインディングが　6.17　で受け入れられ、統合されました。これにより、m1n1 が GPU を初期化し、情報をカーネルに転送する方法を安定させることができます。

電源管理に必要な SPMI コントローラドライバが 6.16 に取り込まれました。M3 Mac 以降で使用されている USB-C mux チップも SPMI バスを介して接続されているため、
このドライバはそれらのマシンの USB に必要です。

オーディオ関連の多くのパッチが 6.16 に取り込まれ、6.17 のキューに入っています。これらのパッチの一部は、上流の I2S コントローラドライバを再構築し、スピーカーアンプが
speakersafetyd に必要なデータを供給できるようにします。これにより、スピーカー対応するために上流で必要なものをすべて上流にもたらします。

コア SMC ドライバが 6.17 で受け入れられ、その GPIO コントローラとリセットコントローラ機能のサブデバイスドライバと一緒に取り込まれました。これらを組み合わせることで、
上流カーネルは Apple Silicon Mac をシャットダウンして再起動するだけでなく、WiFi/Bluetooth モジュールを有効にし、それらを搭載したマシンの USB Type A ポートを
有効にすることができます。また、上流に予定されているのは、ファン制御とこれらのマシンに存在する多数のハードウェアセンサーへのアクセスを可能にする hwmon ドライバ、
サスペンド/再開のための電源ボタン押下をサポートする SMC HID ドライバ、および現在のシステム時刻を読み取り更新する SMC RTC ドライバです。

Linux 6.16 では、かなりクールなマイルストーンに到達しました。最初の進捗報告で、私たちは 1200 を超えるパッチを下流に持ち越していると述べました。ブランチを少し整理し
これまでに上流に統合したのを合わせて、その数は数年ぶりに　1000　を下回り、わずか 5 ヶ月足らずでパッチセット全体の 20 ％強を上流に統合することに成功したことを意味します。
DCP と GPU/Rust のパッチを両方の数字から除外すると、その割合は半分近くに跳ね上がります！

まだまだ道のりは長いですが、この固定はすでにリベースを大幅に楽にし、少しの余裕を与えてくれました。

## その他の修正
今、時間があるので、後回しにするにしていた多くのことを進めることができました。

Plymouth　は TTY メッセージの代わりにブートスプラッシュ画面を表示するシステムで、13 インチのラップトップでの自動 DPI スケーリングが最近壊れました。
これを修正することができました。

最近の OBS の更新により、DRM explicit sync を実装している KMSRO システムでのスクリーンキャスティングが壊れました。これはコンポジタのバグが原因であることが判明し、
[kwin](https://invent.kde.org/plasma/kwin/-/merge_requests/7941)で修正され、
[Mutter](https://gitlab.gnome.org/GNOME/mutter/-/merge_requests/4547)のマージリクエストが提出されました。これらの修正がまだリリースされておらず、
他のコンポジタも同じ問題を抱えている可能性があるため、Janne 氏は[asahi-6.15.8-1](https://github.com/AsahiLinux/linux/releases/tag/asahi-6.15.8-1)の DCP ドライバに
DRM syncobj 対応を追加して回避策としました。

m1n1の開発も再び活発化し始めました。[1.5.0](https://github.com/AsahiLinux/m1n1/releases/tag/v1.5.0)のリリースは、2月以来の最初の新リリースです。
WiFi/Bluetooth モジュールを交換した Mac で欠落しているキャリブレーションデータが原因で発生するブート時のクラッシュの修正など、多くの小さな修正がマージされました。
また、ディストリビューションが m1n1 にカスタムロゴを追加しやすくしました。

## カンファレンストーク
Davide 氏と Neal 氏は[Red Hat Summit](https://events.experiences.redhat.com/widget/redhat/sum25/SessionCatalog2025/session/1731519631980001Xort)と
[DevConf.CZ](https://pretalx.devconf.info/devconf-cz-2025/talk/P3TEBA/) で、Fedora Asahi Remix の進行中の作業と、CentOS Hyperscale SIG での作業の一環としての
CentOS Streamポートの導入について発表しました。これは 7 月の[CentOS Showcase](https://cfp.fedoraproject.org/centos-showcase-2025-07/talk/RRT8NW/) でも取り上げられました。

## プロジェクトグッズ
Asahi Linux への愛を世界に示したいですか？今ならできます！[HELLOTUX](https://www.hellotux.com/asahi)に行って、公式の Asahi Linux グッズを購入してください。
売上の一部がプロジェクトに寄付されます。HELLOTUX に感謝します！

## 次回！
次の報告では、さらに多くの改善と開発がもたらされることを期待していますので、ぜひお楽しみに。いつものように、
[OpenCollective](https://opencollective.com/AsahiLinux)と[GitHub Sponsors](https://github.com/sponsors/AsahiLinux)のサポーターのみなさま
に心からの感謝を申し上げます。サポーターのみなさまがいらっしゃらなければ不可能でした。

#### James Calligeros - 2025-08-07


<!doctype html>
<html lang="ja" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://asfdrwe.github.io/asahi-linux-translations/hw/soc/agx/">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>Apple GPU (AGX) - Asahi Linux 文書非公式日本語訳</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Apple GPU (AGX) - Asahi Linux 文書非公式日本語訳" >
      
        <meta  property="og:description"  content="None" >
      
        <meta  property="og:image"  content="https://asfdrwe.github.io/asahi-linux-translations/assets/images/social/hw/soc/agx.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://asfdrwe.github.io/asahi-linux-translations/hw/soc/agx/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Apple GPU (AGX) - Asahi Linux 文書非公式日本語訳" >
      
        <meta  name="twitter:description"  content="None" >
      
        <meta  name="twitter:image"  content="https://asfdrwe.github.io/asahi-linux-translations/assets/images/social/hw/soc/agx.png" >
      
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#linaagx" class="md-skip">
          コンテンツにスキップ
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="ヘッダー">
    <a href="../../.." title="Asahi Linux 文書非公式日本語訳" class="md-header__button md-logo" aria-label="Asahi Linux 文書非公式日本語訳" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Asahi Linux 文書非公式日本語訳
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Apple GPU (AGX)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="検索" placeholder="検索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="検索">
        
        <button type="reset" class="md-search__icon md-icon" title="クリア" aria-label="クリア" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            検索を初期化
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/asfdrwe/asahi-linux-translations" title="リポジトリへ" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    asfdrwe/asahi-linux-translations
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="ナビゲーション" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Asahi Linux 文書非公式日本語訳" class="md-nav__button md-logo" aria-label="Asahi Linux 文書非公式日本語訳" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Asahi Linux 文書非公式日本語訳
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/asfdrwe/asahi-linux-translations" title="リポジトリへ" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    asfdrwe/asahi-linux-translations
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    概要
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    機能対応
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            機能対応
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Feature-Support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    概要
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../M1-Series-Feature-Support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    M1シリーズ機能対応
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../M2-Series-Feature-Support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    M2シリーズ機能対応
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../M3-Series-Feature-Support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    M3シリーズ機能対応
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../M4-Series-Feature-Support/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    M4シリーズ機能対応
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    プロジェクト関連
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            プロジェクト関連
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Glossary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    用語集
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../FAQ/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../When-will-Asahi-Linux-be-done/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Asahi-Linuxはいつ完成するの？
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Project-References/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    参考資料
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    プラットフォーム文書
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            プラットフォーム文書
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Apple-Silicon-Subsystems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apple Silicon サブシステム
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Apple-Platform-Security-Crash-Course/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Appleプラットフォームセキュリティクラッシュコース
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Devices/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    機器
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Codenames/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コードネーム
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Display-Controllers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ディスプレイコントローラー
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    ユーザ向け
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            ユーザ向け
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://docs.fedoraproject.org/en-US/fedora-asahi-remix/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fedora Asahi Remix文書 <i class="fa-solid fa-arrow-up-right-from-square"></i>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Broken-Software/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    問題があるソフトウェア
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SW-Alternative-Distros/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    代替ディストリビューション
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    開発者向け
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            開発者向け
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Yaks-in-need-of-shaving/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    毛刈りが必要なヤク (助っ人募集！)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Tethered-Boot-Setup-For-Developers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    テザーブートセットアップ(開発者向け)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../m1n1-User-Guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    m1n1:ユーザガイド ブートローダー
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SW-Hypervisor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hypervisor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../U-Boot/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    U-Boot
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SW-DT-bindings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Devicetree bindings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Open-OS-Ecosystem-on-Apple-Silicon-Macs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Apple Silicon MacでのオープンOSエコシステム
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Apple GPU (AGX)</h1>

<p>2025/3/9時点の<a href="https://github.com/AsahiLinux/docs/blob/main/docs/hw/soc/agx.md">agx</a>の翻訳</p>
<hr />
<h4 id="linaagx">Lina氏のAGXノート<a class="headerlink" href="#linaagx" title="Permanent link">&para;</a></h4>
<p>読者注意、ここにドラゴン(dragon)がいます。ポインター型のドラゴン。たくさんいます
(訳注:おそらくドラゴンとは非常に厄介なものを意味しているのかと思います)。</p>
<p>この文書はカーネルドライバの観点からAGXアーキテクチャに焦点を当てています。シェーダやテクスチャサンプリング、
パイプラインコマンドエンコーダなど、純粋にユーザ空間の関心事である側面については説明しません。</p>
<h5 id="_1">概要<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h5>
<p>AGX は PowerVR に<em>強く</em>インスパイアされた（しかし大部分はオーダーメイドの） GPU デザインです。OSインターフェースは、
Appleファームウェアを実行するASC（ARM64）コプロセッサーを介して、ほぼ排他的に仲介されています。すべての通信は、
共有メモリといくつかのmailboxのdoorbellメッセージを介して行われます。すべてのメモリは、私たちが知る限り
コヒーレントです（私たちはまだキャッシュ管理命令を1つも使っていませんが、すべてがまだ機能しています）。</p>
<p>画面に三角形を表示するために必要なレイヤーは、おおよそ次の通りです:</p>
<ul>
<li>UAT (MMU)</li>
<li>ファームウェア初期化</li>
<li>GPU チャネル</li>
<li>GPU コンテクスト</li>
<li>ワークキュー</li>
<li>ワークアイテム</li>
<li>マイクロシーケンス</li>
<li>Tilerバッファ管理</li>
<li>イベント管理</li>
<li>(すべてのユーザ空間のものがここ)</li>
</ul>
<h6 id="uat-unified-address-translator">UAT (Unified Address Translator, 統合アドレス変換器)<a class="headerlink" href="#uat-unified-address-translator" title="Permanent link">&para;</a></h6>
<p>UATはAGXのMMUです。基本的にはARM64のMMUで、同一のページテーブルを使用します。実際、AGX ASCは文字通りUATの
ページテーブルベースをTTBR0/1レジスタとして構成しています。GPU がページパーミッションやその他の属性を
どのように解釈するかについては、CPU の解釈と異なる点があるかもしれませんが、これはまだほとんど未解明です。</p>
<p>GPUのVA(訳注:Virtual Address,仮想アドレスのことかと)は40ビットで、最上位ビットは符号拡張されて64ビットになります。
ARM64と同様に、カーネル/ユーザーアドレス空間が分割されています。ページは常に16Kです。</p>
<p>GPUコンテキストページテーブルのベースアドレスを含む、グローバルで固定されたメモリページが存在します。最大16の
コンテキストがあり（TODO: この制限が本物でドライバ制御でないと再確認）、それぞれにカーネル/ユーザページテーブルの
ための2つのベースレジスタがあります。</p>
<p>macOS は常にコンテキスト 0 をカーネルにのみ使用し（コンテキスト 0 にはユーザページはありません）、すべての
コンテキストでページテーブルのカーネル側半分を共有します。ユーザーVA空間は、コンテキストごとにユニークです。</p>
<p>カーネルのアドレス空間は文字通り ASC ファームウェアもマップします、それは ASC の CPU ページテーブルで
あるからです。これはファームウェアがそれ自身で制御し、初期化中に設定するVA範囲にあります。ホストOSはアドレス空間の
この半分のページテーブルの残りに責任を持ち、そこにすべてのGPU制御構造が行きます。</p>
<p>注：ファームウェアはブートローダによってロードされ、書き込み保護されます。ページテーブルをハイジャックして
AGXファームウェアを完全に乗っ取ることは、現在の設計でも可能ですが、明らかにAppleの意図と方向性は
ASCファームウェアが乗っ取りに対して強化されることなので、現時点では私たち自身のファームウェアを使うことは
考えていません。このGPUを動作させるためにAppleのファームウェアと対話することは、避けられないと考えられています。</p>
<p>TODO: UATのTLB無効化。共有メモリ関係とファームウェアを突くなど</p>
<h6 id="_2">ファームウェア初期化<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h6>
<p>ファームウェアとの通信は、他のASCと共通のRTKitフレームワークを使用しており、ここではカバーしません。メモリ/バッファ管理だけが
異なります（他のASCはDART IOMMU、SARTアドレスフィルタを使用するか、専用SRAMにのみアクセス可能です）。</p>
<p>GPUを初期化するために、初期化データ構造へのポインタを含む1つのメッセージが送信されます。これはより多くのポインターを持つ
複雑なネストされたデータ構造で、次のものを含んでいます:</p>
<ul>
<li>チャネルリングバッファ制御領域とリングバッファ領域へのポインタ</li>
<li>DVFS状態を含む電源管理データ</li>
<li>様々な（主に未知の）データを含む共有メモリ領域</li>
<li>色空間変換係数</li>
<li>MMIOマッピングリスト（ASCがアクセスする必要のあるMMIO領域をマッピングするのはOSの役割）</li>
<li>UATレイアウト情報</li>
<li>様々な未知のバッファ</li>
</ul>
<p>データ構造: <a href="https://github.com/AsahiLinux/m1n1/blob/main/proxyclient/m1n1/fw/agx/initdata.py">initdata.py</a>を参照</p>
<h6 id="_3">チャンネル<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h6>
<p>ファームウェアとの通信は、チャネルリングバッファを介して行われます。チャネルは、リングバッファの中にインラインで配信される
小さな固定サイズのメッセージを保持します。制御構造体は読み込み/書き込みバッファのポインタとサイズを持ち、GPU/CPU が常に
バウンスしないようにキャッシュラインに整列されます。チャネルは両方向にあります。</p>
<p>データ構造: <a href="https://github.com/AsahiLinux/m1n1/blob/main/proxyclient/m1n1/fw/agx/channels.py">channels.py</a>を参照</p>
<h6 id="cpu-gpu">CPU-&gt;GPU チャンネル<a class="headerlink" href="#cpu-gpu" title="Permanent link">&para;</a></h6>
<ul>
<li>ワークチャンネル: 4つのグループ(0-3)、それぞれ3つのチャンネル、GPUワークタイプごとに1つ</li>
<li>TA (Tile Accelator、頂点処理)</li>
<li>3D (3D、ピクセル処理)</li>
<li>CP (Compute)</li>
</ul>
<p>TODO: 異なるチャンネルに送られたワークにはおそらく何らかの優先順位スキームがあるはず</p>
<ul>
<li>デバイス制御チャネル、デバイス全体のメッセージ用 (例: GPU init とおそらく電源管理関連のもの)</li>
</ul>
<h6 id="gpu-cpu">GPU-&gt;CPU チャンネル<a class="headerlink" href="#gpu-cpu" title="Permanent link">&para;</a></h6>
<ul>
<li>イベント：作業関連のイベント通知</li>
<li>作業完了フラグイベント<ul>
<li>これらはどのイベントインデックスが発火しているかを示す128ビットの配列を持つ</li>
</ul>
</li>
<li>フォールト通知<ul>
<li>GPUのフォールトはStop-the-Worldの処理としてはかなり貧弱に見える。macOS は実際に GPU MMIO レジスタを直接ダンプするようになり、ファームウェアは何をすべきかについてとても無知であるように思われる</li>
</ul>
</li>
<li>統計メッセージ</li>
<li>私たちはこれらを無視。バッファがオーバーフローした場合、ファームウェアは一度だけ文句を言うが、無害</li>
<li>ファームウェアのsyslog</li>
<li>これは、何らかの理由で複数のサブチャンネルが存在し、制御構造が連続的にレイアウトされているという点で奇妙</li>
<li>未知のチャネル(トレース?)</li>
</ul>
<h6 id="gpu">GPU コンテキスト<a class="headerlink" href="#gpu" title="Permanent link">&para;</a></h6>
<p>GPU コンテキストはいくつかの小さな共有構造体にマッピングされ、いくつかは ASC によって生成されます。これはほとんどまだ未定です。</p>
<h6 id="_4">ワークキュー<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h6>
<p>ワークキューは特定のタイプのワークアイテムを保持します。通常、コンテキストごとに複数のワークキューがあります
 (例えば、3D レンダリングには少なくとも 3D と TA が存在)。ワークキューはいくつかの構造体で表現され、主に
CPU が初期化し GPU が管理するメイン構造体と、コンテキスト構造体へのポインタ、リングバッファ、リングバッファ
ポインタブロックなどで構成されています。リングバッファは個々のアイテムへのポインタの配列です（インラインではない）。</p>
<p>ワークキューを処理するために、OSはワークキュー管理構造体へのポインタと最新のリングバッファ書き込みポインタをワーク
チャンネルに送信します。加えて作業完了を知らせるイベントインデックスや新しいワークキューからの最初の送信かどうかを
示すフラグを持つメッセージを送信します。</p>
<p>データ構造: <a href="https://github.com/AsahiLinux/m1n1/blob/main/proxyclient/m1n1/fw/agx/cmdqueue.py">cmdqueue.py</a> を参照</p>
<h6 id="_5">ワークアイテム<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h6>
<p>ワークアイテムは GPU 作業または関連する操作を表します。これらは、特定のレイアウトで埋め込まれたサブ構造を含む
かなり大きなバッファです（これらのサブ構造のいくつかへのポインタは存在しますが、ファームウェアは特定の方法で埋め込むことを
想定しているので、レイアウトは尊重されなければなりません）。</p>
<p>データ構造: <a href="https://github.com/AsahiLinux/m1n1/blob/main/proxyclient/m1n1/fw/agx/cmdqueue.py">cmdqueue.py</a> を参照</p>
<h6 id="_6">マイクロシーケンサー<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h6>
<p>ASCファームウェアは、作業コマンドの一部としてかなり複雑な『スクリプト』を実行できるコマンドシーケンサーを含んでいますが、
通常は明らかに基本的な方法で使用されます。これらのシーケンスは、ワークアイテムの一部として実行されるコマンドのバッファを
パックしたものです。典型的なシーケンスは:</p>
<ul>
<li>開始(3D/TA/CP)</li>
<li>タイムスタンプの書き込み</li>
<li>アイドル待ち</li>
<li>タイムスタンプの書き込み</li>
<li>終了(3D/TA/CP)</li>
</ul>
<p>データ構造: <a href="https://github.com/AsahiLinux/m1n1/blob/main/proxyclient/m1n1/fw/agx/microsequence.py">microsequence.py</a> を参照</p>
<h6 id="tiler">Tilerバッファの管理<a class="headerlink" href="#tiler" title="Permanent link">&para;</a></h6>
<p>GPU Tiler は頂点属性とプリミティブデータを格納するバッファを必要とします。これはドライバが提供するいくつかの固定サイズのバッファと、
GPU ファームウェアが任意に割り当てるヒープによって行われます。ヒープはバッファマネージャオブジェクトと、それが指す
いくつかのバッファを介して管理され、CPUはブロック（4ページ）とページ（各32KでVA空間（！）内でアライン）のリストを提供します。</p>
<p>Tilerバッファオーバーフロー/一部保存/再ロード処理は、ASCファームウェアによって完全に管理されています。</p>
<p>データ構造: <a href="https://github.com/AsahiLinux/m1n1/blob/main/proxyclient/m1n1/fw/agx/microsequence.py">microsequence.py</a> の BufferManager* を参照</p>
<h6 id="_7">イベント管理<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h6>
<p>ワーク完了は、RAM上の32ビットワードであるスタンプオブジェクトへの値の書き込みによって通知されます。通常0に初期化され、
ワークアイテムが処理されるたびに0x100ずつ増加します。各ワークアイテムは、イベントID（0〜127）とイベント管理構造体にも
関連付けられます。この構造体は、1人のユーザーに対して3D/TA間で共有され、ベースバリア値と（？）イベント数閾値を含んでいます。
閾値に達すると、対応するイベントIDがCPUへのイベントメッセージでアサートされます。これがどのように動作しカウントされるかは
まだ不明で、というのも、同じ構造がロックステップで増加する異なるバリアオブジェクトを使用する異なるキュー間で共有されていますが、
両方のイベントを取得するために閾値は2でなければならないのにそれぞれが1ずつ増加するだけだからです... 未確定</p>
<h5 id="3d">3D フレームの描画<a class="headerlink" href="#3d" title="Permanent link">&para;</a></h5>
<p>フレームを描画するには、まず以下のものが必要です。</p>
<ul>
<li>使用する一対の 3D/TA チャンネル</li>
<li>完了通知のためのイベントインデックスのペア</li>
<li>WorkQueueのペア</li>
<li>UATのコンテキストID</li>
<li>共有コンテキスト構造体</li>
<li>Tilerの静的バッファ</li>
<li>Tiler ヒープマネージャと関連するバッファ/リスト</li>
<li>4つのスタンプオブジェクト</li>
</ul>
<h6 id="tiler_1">Tilerバッファ<a class="headerlink" href="#tiler_1" title="Permanent link">&para;</a></h6>
<ul>
<li>(U) TVB タイル配列 (タイル数に依存)</li>
<li>(U) TVB リスト配列 (タイル数に依存?)</li>
<li>(U) TVB ヒープメタデータブロック (固定サイズ?)</li>
<li>(K) TVB ヒープマネージャ &amp; (U) ヒープ (任意のサイズ &gt;= 3 128K ブロック、CPU は将来のフレームに対するオーバーフローに対応して動的に調整可能)</li>
</ul>
<p>macOSはこれらをカーネルで割り当てています。カーネルでやりたいですか？ユーザースペースでやりたいですか？ユーザースペースは
少なくともサイジングを制御する必要があるのではないでしょうか？カーネルに決定させるか、または、ユーザスペースがバッファマネージャにページを
提供するようにすることができます。カーネルは少なくともヒープマネージャの構造を扱う必要があります。</p>
<h6 id="_8">スタンプオブジェクトとイベント管理<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h6>
<p>128 個のイベントインデックスがあります。レンダーは 4 つのスタンプオブジェクトを必要とし、TA/3D のためにそれぞれ 2 つ必要です。
現在の理論では、1つのスタンプは作業の完了を示し、もう1つは完了イベントがCPUに配信されたことを示します（ワークが刈り取られた？）</p>
<h6 id="ta">TAワーク<a class="headerlink" href="#ta" title="Permanent link">&para;</a></h6>
<p>TAワークは通常このような感じです:</p>
<h6 id="_9">ヒープマネージャの初期化<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h6>
<p>初回またはヒープサイズが変更されたときに必要です。CPUが管理ストラクタを再初期化したことをGPUに伝えます。</p>
<p>未知のコンテキスト関連IDが含まれます。これはヒープマネージャのIDかも？新しい）TAスタンプの値も渡されます。</p>
<h6 id="ta_1">TAを実行<a class="headerlink" href="#ta_1" title="Permanent link">&para;</a></h6>
<p>注：これはすべて要約であり、大量の未知/固定/マジックナンバーを無視</p>
<ul>
<li>このジョブのUATコンテキストID</li>
<li>イベント管理構造体ポインタ</li>
<li>ヒープマネージャ構造体ポインタ</li>
<li>ある種の関連するバッファ記述子へのポインタ(?)</li>
<li>未知のバッファへのポインタ(空)</li>
<li>タイムスタンプ 1 ptr</li>
<li>タイムスタンプ 2 ptr</li>
<li>タイムスタンプ 3 ptr</li>
<li>未知のバッファ 2 (空)</li>
<li>組み込みの構造体:</li>
<li>Tilerパラメータ(タイル数など)</li>
<li>TAワーク構造体2<ul>
<li>TVB タイルマップ ptr</li>
<li>TVB リスト ptr</li>
<li>ユーザースペースから渡される3つの小さなバッファ（aryssa氏はこれらを『deflake』と呼ぶ）</li>
<li>コマンドエンコーダーptr (つまりユーザー空間から実際に実行されるgfxパイプライン)</li>
<li>パイプラインウィンドウのベース（32ビットシェーダのポインタに使用されるVAへの4GiBウィンドウ）</li>
</ul>
</li>
<li>TAワーク構造体3<ul>
<li>deflake ptrの1つ</li>
<li>エンコーダーID（ユニークなID、GPUはおそらく触れない）</li>
<li>『未知のバッファ』（ユーザースペースからの数字が増加）</li>
<li>TAバリア1、2へのポインタ</li>
<li>完了時に書き込むスタンプの値</li>
<li>いくつかのUUID</li>
</ul>
</li>
<li>マイクロシーケンスポインタ</li>
<li>再度完了スタンプ値(Completion stamp value again)</li>
<li>3Dに割り当てられたイベント番号(TVBオーバーフロー時のTA/3D連携のため?)</li>
<li>TVBタイル配列の再作成とサイズ</li>
</ul>
<h6 id="ta_2">TAマイクロシーケンス<a class="headerlink" href="#ta_2" title="Permanent link">&para;</a></h6>
<p>マイクロシーケンスはTAワークによって指し示され、以下のコマンドを持つ。</p>
<h6 id="ta_3">TAを開始<a class="headerlink" href="#ta_3" title="Permanent link">&para;</a></h6>
<ul>
<li>タイリングパラメータ ptr</li>
<li>TAワーク構造体2 ptr</li>
<li>ヒープマネージャ ptr</li>
<li>バッファ記述子へのポインタ</li>
<li>共有GPUのinitdataの配列への何らかのポインタ（？）</li>
<li>ワークキュー制御構造体へのポインタ</li>
<li>UATコンテキストID</li>
<li>その他のコンテキスト関連ID（ヒープmgr ID？）</li>
<li>TAワーク構造体3 ptr</li>
<li>Execute TAの未知バッファの1つへのポインタ</li>
<li>UUID</li>
</ul>
<h6 id="_10">タイムスタンプ<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h6>
<ul>
<li>Flag=1</li>
<li>実行TA内の3つのタイムスタンプポインタへのポインタ。#1, #2, #2</li>
<li>UUID</li>
</ul>
<h6 id="_11">アイドルを待つ<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h6>
<ul>
<li>Args: 1, 0, 0</li>
</ul>
<h6 id="_12">タイムスタンプ<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h6>
<ul>
<li>フラグ=0</li>
<li>実行TAで3つのタイムスタンプポインタを指す。#1, #2, #3 (違いに注意)</li>
<li>UUID</li>
</ul>
<h6 id="ta_4">TAを終了<a class="headerlink" href="#ta_4" title="Permanent link">&para;</a></h6>
<ul>
<li>そのバッファのものへのポインタ(Pointer to that buffer thing)</li>
<li>ヒープマネージャへのポインタ</li>
<li>TA開始時と同じinitdataポインタ</li>
<li>作業キューへのポインタ</li>
<li>UATコンテキストID</li>
<li>TA構造体3へのポインタ</li>
<li>UUID</li>
<li>TAスタンプ2へのポインタ</li>
<li>書き込むスタンプの値</li>
<li>Start TA micro コマンドまでのオフセット（おそらく部分レンダリング用に再開するため？）</li>
</ul>
<h6 id="3d_1">3Dワーク<a class="headerlink" href="#3d_1" title="Permanent link">&para;</a></h6>
<h6 id="_13">バリア(スタンプ待ち)<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h6>
<p>TA が終了するまで 3D をブロックします。部分レンダリングを動作させる黒魔術が何なのかは不明です。</p>
<ul>
<li>TAスタンプへのポインタ #2</li>
<li>待機する値</li>
<li>再び待機する値（範囲？）</li>
<li>TAイベントのインデックス（おそらくこれは実際のポールを通知します。）</li>
<li>UUID</li>
</ul>
<h6 id="3d_2">3Dを実行<a class="headerlink" href="#3d_2" title="Permanent link">&para;</a></h6>
<ul>
<li>イベント管理構造体ポインタ</li>
<li>タイラーヒープマネージャーポインタ</li>
<li>バッファディスクリプターへのポインター</li>
<li>未知の空バッファ</li>
<li>TVBタイル配列ポインタ</li>
<li>その他の未知の空のバッファ</li>
<li>タイムスタンプ 1  ptr</li>
<li>タイムスタンプ 2 ptr</li>
<li>タイムスタンプ 3 ptr</li>
<li>組み込みの構造体</li>
<li>3Dワーク構造体1<ul>
<li>いくつかのフロート？</li>
<li>デプスクリア値</li>
<li>ステンシルクリア値</li>
<li>デプスバイアス配列 ptr</li>
<li>シザー配列 ptr</li>
</ul>
</li>
</ul>
<p>(未完成)</p>
<h4 id="phirem1x-gpu-infodump">phireのM1x GPU infodump<a class="headerlink" href="#phirem1x-gpu-infodump" title="Permanent link">&para;</a></h4>
<p><code>phire-gpu-infodump.md</code> からここに移動</p>
<p>全ての作業はMacOS 12.2搭載のT6000 14インチM1 Maxで行われました。</p>
<p>今のところ、これは大雑把にいってGPUにどのようにワークを送り込むかを見つけるための挑戦です。</p>
<h5 id="uat-iommu-unified-address-translator">UAT iommu (別名: Unified Address Translator、統合アドレス変換器)<a class="headerlink" href="#uat-iommu-unified-address-translator" title="Permanent link">&para;</a></h5>
<p>m1n1/hw/uat.py に十分に完成したUATの実装があります。</p>
<p>4レベルのページテーブルです:</p>
<ul>
<li>L0: 2エントリ</li>
<li>L1: 8エントリ</li>
<li>L2: 2048エントリ</li>
<li>L3: 2048エントリ</li>
</ul>
<p>ページは16KB固定サイズです。</p>
<p>(少し奇妙な) レイアウトにより、共有 VM 領域 (<code>0xf80_00000000</code> 以上) は L0[1] に、
コンテキストごとの割り当てはすべて L0[0] に配置され、新しいコンテキスト用に L0 テーブルを簡単に構築できます。</p>
<p>TTBRレジスタは見当たりませんしレジスタもありません。gfx-ascがこの iommu を完全に制御しているようです。
プライベート IO 領域のために自身のページテーブルをセットアップします。</p>
<p>これはセキュリティの意味合いがあり、gfx-asc はすべての物理ページと、(すべてではないにしても) いくつかの
MMIOレジスタにアクセスできます。macOSカーネルからのパニックメッセージは"microPPL"がgfx-ascコプロ上で
動作している可能性を示唆しており、macOSでのPPLと類似しており、これはおそらくページテーブルを変更できる唯一の
部品でしょう。</p>
<p>macOS のカーネルには便利なカーネルオプション、<code>iouat_debug=1</code> があり、このアドレス空間のすべての割り当てと解放を
記録します。</p>
<p>PTEの形式の詳細については m1n1.hw.PTE を参照してください。</p>
<h5 id="gpu_1">GPU 仮想アドレス空間<a class="headerlink" href="#gpu_1" title="Permanent link">&para;</a></h5>
<p>macOS は(少なくとも私のマシンでは)以下の範囲の GPU VA を使用します:</p>
<p><code>0x015_00000000</code>: ほとんどのユーザ空間割り当て<br />
<code>0x011_00000000</code>: いくつかの追加のユーザ空間割り当て<br />
<code>0x06f_ffff8000</code>: 不明。単一ページのみ
<code>0xf80_00000000</code>: ASC のプライベート VM 領域。ASC のプライベート VM 領域で、自分自身で割り当て。主にASCファームウェアが含まれる
この領域は <code>/arm-io/sgx/rtkit-private-vm-region-base</code> と同じ位置</p>
<p><code>0xf80_10000000</code>: ASC ファームウェアによってマップされた IO 領域。ASCメールボックスレジスタのみが含まれる
<code>0xfa0_00000000</code>: macos カーネルが物を割り当てる領域
<code>0xfa0_10000000</code>: macOS によってマップされた IO 領域。
ASC 領域、PMRG レジスタ、MCC レジスタへのポインタ (他にも?)</p>
<p>ポインタは符号拡張されることがあるので、以下のような範囲のポインタを見かけることがあります。
<code>0xffffff80_00000000</code> や <code>0xffffffa0_00000000</code> といった範囲のポインタを見かけることがありますが、実際には40ビットしかありません。
しかし、実際には40ビットのアドレス空間しかありません。カーネルからのログは通常44ビットを報告しているので、<code>0xfa_000000</code>というアドレスになります。</p>
<p>UATはこのアドレス空間を制御しています。</p>
<h5 id="gfx-asc">gfx-asc<a class="headerlink" href="#gfx-asc" title="Permanent link">&para;</a></h5>
<p>ASC インターフェースは、ワークを送り込むための自然なインターフェースのように思われます。</p>
<p>けれども、このインターフェイスには衝撃的なほど少ないトラフィックしかありません。特に私が見てきたDCPと比べると。</p>
<h6 id="_14">エンドポイント<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h6>
<p>0x0: 標準的な管理、特におかしなところはなし
 0x1: 標準的なクラッシュログのエンドポイント
0x20：これをPongと呼ぶ。通常の "pongs"を受信
0x21：これをKickと呼ぶ </p>
<h6 id="_15">クラッシュログ エンドポイント<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h6>
<p>全体のトラフィック:</p>
<pre><code>RX 0x00120000000000
TX 0x00104fa00c388000
</code></pre>
<p>そして、初期化直後に発生</p>
<p>0xfa00c388000 は GPU VA で、単一ページのアロケーションを指しています。
初期化中に繰り返されるパターン（16KBの0xefバイトの繰り返し）で埋められ、その後二度と触れません。</p>
<h6 id="pong">Pongエンドポイント<a class="headerlink" href="#pong" title="Permanent link">&para;</a></h6>
<p><em>クラッシュログはこのエンドポイントを "User01 "と呼んでいます</em>。</p>
<p>Pongメッセージの数がキックと一致しないので、おそらく名前を間違えたのでしょう。もっと多いかもしれない。
あるいは、GFX ファームウェアが CPU にページテーブルに触れたことを伝えているのかもしれません。</p>
<p>また、このエンドポイントでは、Initエンドポイントの後に、さらにいくつかの初期化が行われます。</p>
<p>メッセージ
<code>RX 0x00420000000000</code>: pongです。下位ビットを0以外に設定することはなし
<code>TX 0x00810fa0000b0000</code>: 初期化、一度だけ送信</p>
<p>初期化データとしてヌルポインタを送ると、クラッシュログ上で次のようなクラッシュが発生します:</p>
<pre><code>GFX PANIC - Unable to grab init data from host - agx_background(2)
</code></pre>
<p>painclogには次のアクティブなタスクが表示されます:</p>
<ul>
<li>rtk_ep_work</li>
<li>power</li>
<li>agx_background</li>
</ul>
<p>そして、パニックは agx_background で発生します。<em> このエンドポイントはagx_backgroundに属しているということでしょうか？</em></p>
<p>初期化データが提供された後、このエンドポイントにメッセージを送ってクラッシュさせることができませんでした。</p>
<h6 id="pong_1">Pong初期化<a class="headerlink" href="#pong_1" title="Permanent link">&para;</a></h6>
<p>これにはGPU VAも含まれており、CPUによって事前に埋められるデータ構造を指しています:</p>
<pre><code>&gt;&gt; chexdump32(gfx.uat.ioread(0, 0xfa0000b0000, 0x4000))
00000000 000b8000 ffffffa0 00000000 00000000 0c338000 ffffffa0 00020000 ffffffa0
00000020 000c0000 ffffffa0 030e4000 240e0e08 40000008 00000001 00000000 ffffc000
00000040 000003ff 00000000 00000070 190e0e08 40000800 00000001 00000000 ffffc000
00000060 000003ff fe000000 0000000f 0e0e0e08 40000800 00000001 00000000 ffffc000
00000080 000003ff 01ffc000 00000000 00000000 00000000 00000000 00000000 00000000
000000a0 00000001 00000000 00000000 00000000 00000000 00000000 00000000 00000000
000000c0 00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000
</code></pre>
<p>このControlStructをm1n1/trace/agx.pyのコードで呼び出してみました。</p>
<p>初期化後、CPUはこれに触れることはありません。</p>
<p>unkptr_18 は asc-firmware が使うヒープかスタックのようです？</p>
<h6 id="kick">Kick<a class="headerlink" href="#kick" title="Permanent link">&para;</a></h6>
<p><em>クラッシュログはこのエンドポイントを 『User02』と呼んでいます。</em></p>
<p><strong>メッセージ:</strong>  </p>
<p><code>0x83000000000000</code>: TAチャンネルを送信
<code>0x83000000000001</code>: 3Dチャンネルを送信
<code>0x83000000000002</code>: CLチャンネルを送信
<code>0x83000000000010</code>: ファームウェアのkick
<code>0x83000000000011</code>: 機器制御</p>
<p>これらのKickはワークの送り込みをトリガーしているかもしれませんが、5ビットのエントロピーしかないため、実際の情報は共有メモリのどこかにあるはずです。
しかし、現時点では、キック間で変更される共有メモリは見つかっていません。また、私はこれを間違って表示した可能性があり、kickは実際にはTLBの無効化です。</p>
<p>範囲外のkickで <code>0x008300000000</code> メッセージを送ってもメッセージタイプ 0x84 と 0x85のクラッシュは起こりません。</p>
<h6 id="_16">チャンネル<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h6>
<h6 id="0">チャンネル 0<a class="headerlink" href="#0" title="Permanent link">&para;</a></h6>
<p><code>0x8300000000</code> で使用: TA チャンネルを送信</p>
<p>00000000 0c000000 ffffffa0 00000002 00000000 00000001
00000000 0C3A8000 FFFFFA0 00000002 00000002 00000001
00000000 0C000000 FFFFFA0 00000003 00000000 00000000
00000000 0C3A8000 FFFFFA0 00000003 00000002 00000000
00000000 0C3A8000 FFFFFA0 00000004 00000002 00000000
00000000 0C3A8000 FFFFFA0 00000005 00000002 00000000</p>
<h6 id="1">チャンネル1<a class="headerlink" href="#1" title="Permanent link">&para;</a></h6>
<p><code>0x83000000000001</code> で使用: 3D チャンネルを送り込み</p>
<p>00000001 0C002CC0 FFFFFA0 00000002 00000001 00000001
00000001 0C3AACC0 FFFFFA0 00000002 00000003 00000001
00000001 0C002CC0 FFFFFA0 00000004 00000001 00000000
00000001 0C3AACC0 FFFFFA0 00000004 00000003 00000000
00000001 0C3AACC0 FFFFFA0 00000006 00000003 00000000
00000001 0C3AACC0 FFFFFA0 00000008 00000003 00000000
00000001 0C002CC0 FFFFFA0 00000006 00000001 00000000
00000001 0C3AACC0 FFFFFA0 0000000A 00000003 00000000</p>
<h6 id="12">チャンネル12<a class="headerlink" href="#12" title="Permanent link">&para;</a></h6>
<p>機器制御で使用 - <code>0x83000000000011</code></p>
<p>カーネルは gfx-asc を初期化する前に、チャンネル 12 にメッセージを入れます。</p>
<p>メッセージタイプ 0x19</p>
<p>次に</p>
<p>メッセージタイプ 0x23</p>
<p>メッセージ 0x17:</p>
<pre><code>メタルテストを起動するときに表示
</code></pre>
<h6 id="13">チャンネル13<a class="headerlink" href="#13" title="Permanent link">&para;</a></h6>
<p>GPU ファームウェアから？</p>
<p>転送は通常の 0x30 ではなく、実際には 0x38 バイトの長さです。</p>
<pre><code># chan[13]-&gt;ptrB (0xffffffa000031f00..0xffffffa0000350af)
ffffffa000031f00 00000001 00000000 00000000 00000000 4b430000 534b5452 4b434154 | .................... CKRTKSTACK
ffffffa000031f20 534b5452 4b434154 534b5452 4b434154 534b5452 4b434154 00000001 00000002 | RTKSTACKRTKSTACKRTKSTACK...............FFFFFFA000031f40 534B5452 4B534154 534BRKSTACK......FFFFFFA000031f40
ffffa000031f40 00000000 00000000 ffff0000 00000080 00000000 000040e8 00000000 | .........................@.
FFFFFFA000031F60 00001180 00021300 000040E0 00000000 00000000 00000000 00000000 | ......@...............................................@........@....@....@...
</code></pre>
<h6 id="14">チャンネル14<a class="headerlink" href="#14" title="Permanent link">&para;</a></h6>
<p>チャンネル12への返信？</p>
<p>メッセージタイプ 0x4</p>
<h6 id="16">チャンネル16<a class="headerlink" href="#16" title="Permanent link">&para;</a></h6>
<p>タイムスタンプチャンネル。</p>
<p>これはgpu ファームウェア (または gpu 自体) が持っていたすべての機能またはモードのタイムスタンプを表示する可能性があります。</p>
<p>Type 0xc - 何も起こっていない</p>
<h6 id="_17">タスク<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h6>
<p>crashlogsによると、gfx-ascは以下のタスクを実行しています。</p>
<ul>
<li>rtk_ep_work</li>
<li>power</li>
<li>agx_background</li>
<li>agx_recovery</li>
<li>agx_interrupt</li>
<li>agx_power</li>
<li>agx_sample</li>
</ul>
<h5 id="arm-iosgx">/arm-io/sgx の様々な共有メモリ範囲<a class="headerlink" href="#arm-iosgx" title="Permanent link">&para;</a></h5>
<p>共有メモリに関して、これらは明確なものです。ibootによって割り当てられ、ADTにリストアップされています。</p>
<p><strong>gpu-region-base:</strong></p>
<p>UATのL0テーブルを含む単一ページ。CPUによって制御されます。</p>
<p>与えられたコンテキストの L0 は <code>gpu-region-base + context * 0x10</code> で見つけられます。</p>
<p><strong>gfx-shared-region-base:</strong></p>
<p>初期化中にgfx-ascが自ら割り当てる、すべてのプライベートなページテーブルが含まれます。</p>
<p>ほとんどはgfx-ascによって制御されるが、CPUはPPE <code>L0[1][2]</code> を制御し、自身のメモリ内のL2テーブルにそれを指し示します。</p>
<p><code>L0[1]</code>のPTEはこの領域の開始を指し示すようです。</p>
<p><strong>gfx-handoff-base:</strong></p>
<p><code>0x10ffb4000</code> : u64 - microPPL マジック値 <code>0x4b1d000000000002</code>
<code>0x10ffb4008</code> : u64 - microPPL マジック値 <code>0x4b1d000000000002</code></p>
<p>この値を破壊すると、以下のようなパニックが発生します:</p>
<pre><code>panic(cpu 4 caller 0xfffffe0013c5d848): UAT PPL 0xfffffdf030af4160 (IOUAT): 
Invalid microPPL magic value found in the handoff region. 
Expected: 0x4b1d000000000002, Actual: 0x0
</code></pre>
<p><code>0x10ffb4018</code> : u32 - 一般に u8 として読み込み - 0xffffff に初期化
<code>0x10ffb4038</code> : u32 - フラッシュ状態 (一般に 0 か 2 に設定される)  </p>
<p>CPUはこれを2にセットし、以下の値をいくつか変更した後、0に戻すというパターンを持っています。
これはミューテックス(mutex)ではないでしょうか？</p>
<p>CPUが想定していないときにこれを2に変更すると、次のようにパニックを起こします。</p>
<pre><code>panic(cpu 0 caller 0xfffffe0013b6d8c4): UAT PPL 0xfffffdf0429d0160 (IOUAT): 
    Attempted to call prepareFWUnmap() before completing previous cache flush. 
    flush_state: 2 | start_addr: 0x150e540000 | size: 0x730000 | context_id: 1
</code></pre>
<p><code>0x10ffb4040</code> : u64 - CPU が GPU の VA をここにときどき書き込む
<code>0x10ffb4048</code> : u64 - サイズは 0x28000 や 0x8000 のような丸められた数字に設定
<code>0x10ffb4050</code> : u64 - CPU が GPU の VA をここにときどき書き込む
<code>0x10ffb4058</code> : u64 - 別のサイズ。</p>
<p><code>0x10ffb4098</code> : u64 - 4038 と同じように扱われるが、40a0 に触れる場合
<code>0x10ffb40a0</code> : u64 - CPU は時々ここに GPU VA を書き込む、私はメタルアプリを実行している時にしか見たことがない<br />
<code>0x10ffb40a8</code> : u64 - サイズ？ </p>
<p><code>0x10ffb4620</code> : u32 - ?<br />
<code>0x10ffb4638</code> : u8 - 0x4038 が変更される前に常にチェック</p>
<p>CPUはこの範囲に興味深いGPU VAポインタを書き込みます。私は長い間、これがGPUへのワークの送り込み方法に違いないと考えていました。
しかし、kickやpongとは関係なさそうです。時々カーネルはポインタを何度も上書きして、その間にkickやpongがゼロになることもあります。
また、この領域で何も変更せずに何百回ものkickを行うこともあります。</p>
<p>私の現在の仮説では、この領域はページテーブルの更新状況を追跡するために排他的に使用されています。
MacOSとgfx-ascの両方からアクセス可能で、ページテーブルの更新のためにアクセスを同期させることができます。</p>
<p>次のパニックメッセージ `GFX PANIC - Host-mapped FW allocations are disabled, but FW only supports enabled``
(initdataの0xa0バイトを0に設定したときに表示) は、この『ファームウェアによるページテーブルの制御』が機能的に有効でないことを示唆しています。
機能的にこのファームウェアのバージョンで実際に有効になっていないことを示唆しています。<br />
運が良ければ、このハンドオフ領域には何も書き込まないようにできるかもしれません。</p>
<h5 id="sgx">sgx レジスタ<a class="headerlink" href="#sgx" title="Permanent link">&para;</a></h5>
<p>CPU はこれらのレジスタに書き込まず、読み込むだけです。</p>
<p>これらのレジスタは初期化時に一度だけ読み込まれます:</p>
<pre><code>0x4000 : u32 - バージョン番号? 0x4042000
0x4010 : u32 - バージョン番号? 0x30808
0x4014 : u32 - バージョン番号? 0x40404
0x4018 : u32 - 不明 0x1320200
0x401c : u32 - 0x204311
0x4008 : u32 - 0x40a06
0x1500 : u32 - 0xffffffff
0x1514 : u32 - 0x0
0x8024 : u32 = 0x43ffffe - (これはADTのsgx/ttbat-phys-addr-baseに適合)
</code></pre>
<p>これらのステータス・レジスタは、CPU上の<em>something</em>によって継続的にチェックされます。</p>
<pre><code>0x11008 : u32 - 作業が行われるたびに常にカウントアップされます。
0x1100c : u32 - 通常は0です。
0x11010 : u32 - 別の作業カウンタ？
0x11014 : u32 - 使用頻度0
</code></pre>
<p>ASCのPongとKicksに比べると、これらのステータス・レジスタが読まれるタイミングに多くの関係はないようです。</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  ページトップへ戻る
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.expand", "navigation.instant", "navigation.sections", "navigation.tracking", "navigation.top", "toc.integrate"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f", "clipboard.copy": "\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3078\u30b3\u30d4\u30fc", "search.result.more.one": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3082\u30461\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.more.other": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3042\u3068#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.none": "\u4f55\u3082\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f", "search.result.one": "1\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.other": "#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.placeholder": "\u691c\u7d22\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044", "search.result.term.missing": "\u691c\u7d22\u306b\u542b\u307e\u308c\u306a\u3044", "select.version": "\u30d0\u30fc\u30b8\u30e7\u30f3\u5207\u308a\u66ff\u3048"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
    
  </body>
</html>
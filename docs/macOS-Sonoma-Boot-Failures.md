2025/3/1時点の[macOS Sonoma Boot Failures](https://github.com/AsahiLinux/docs/blob/main/docs/macOS-Sonoma-Boot-Failures.md)の翻訳

訳注: Appleの英語版公式サイトへのリンクは対応する日本語版サイトへのリンクに変更

---
## 重要な更新

macOS 14.1.1や14.2 beta 2や ~~（おそらく）13.6.2~~で、Appleはブート時のスクリーンモードに対してProMotion設定を
変更しないように変更することでバグを『修正』しました。

**残念なことに、起動時のスクリーンモードを安全な（ProMotion）設定にリセットするのを実際は忘れており、ProMotionを無効にして
アップグレードしたユーザーは、永遠に壊れた状態から抜け出せないことになってしまいました。
さらに悪いことに、macOSでこの状態を先取りして検出する方法がわかりません。**

もっと悪いことに、Appleはいまだに14.xへのシステムリカバリーのロールフォワードを強制していないため、バグが
発生した場合、大半のユーザーはリカバリーが不可能という最悪の危険な状態に陥ることになります。

Appleが将来のバージョンでこの問題を適切に修正することを期待していますが、この暫定的な『修正』をどのように考えたのか、
1mmも理解できません。この『修正』では、影響を受けたユーザーをさらに混乱させ、静かに死に至らしめてしまいます。

このアップデートの結果、安全上の理由から、古いシステムリカバリーを搭載した影響を受けるシステムのサブセット（おそらく14インチと16インチのマシンと
最新のmacOSを搭載しているユーザーの大多数）へのAsahi Linuxのインストールを全面的にブロックすることになりました。申し訳ありません。
色々試してみましたが、私たち側でこの問題にパッチを当てたり、ユーザーのために問題のケースを事前に検出するのは諦めています。
Appleが壊したのだから、Appleだけが修正することができ、正しい方法で修正する必要があります。それ以外に私たちにできることはありません。

現時点での唯一の回避策は、別のMacを使って先手を打ってDFU復元を行うことです。そうすれば、システムリカバリーが強制的にアップグレードされ、
少なくとも機能するフェイルセーフがシステムに残ります。この場合でもAsahiのインストール中に問題が発生する可能性はありますが、少なくとも
macOSに戻ることは可能です（この場合、Appleが修正するまでAsahiをインストールしないことには変わりません）。インストーラーは、
最新のシステムリカバリーを持っているユーザーに対しては、警告とともにインストールを許可します。

## 何が起きていますか?

**更新 2023年11月09日:  Appleはこのバグの修正を謳ったVentura 13.6.2をリリースしました。現時点では、これはシングルブートのVentura
ユーザーに影響する最悪の状況（このドキュメントの最後のセクションを参照）を回避するための暫定的な修正であり、完全な修正ではないと思われます。
マルチブートユーザーやAsahi Linuxユーザー（より少ない程度ですが）はまだ同様の影響を受けています。Sonoma 14.2 リリースで
主要な/完全な修正が行われることを期待しています（現在ベータ版で、ベータ 1 ではまだ修正されていません）。**

**更新：Asahi インストーラとブートローダ m1n1とasahi-nvram に変更を加えました。現時点では、Asahi をインストールした場合や
Asahiインストール済みの場合でも、シングルブートマシンで通常の素のSonomaアップグレードと比較して、新たな危険が生じることはないと考えています。**

macOS Sonoma と macOS Ventura 13.6 は、アップグレードとブートプロセスに複数の深刻なバグを抱えたままリリースされました。これらのバグが重なると、
電源ボタンをどのように押しても、マシンが常に黒画面で起動するような状況が発生します。これによりユーザーは立ち往生してしまい、唯一の解決策は
DFUリカバリを使用することだけです。

**このバグは、Asahi Linuxをインストールしているユーザーにも、インストールしていないユーザーにも影響する可能性があります。**

この状況は、特定のモデルの特定の設定で、複数のmacOSバージョン（1つはSonoma、もう1つはそれ以前）が並行してインストールされている場合に発生する可能性が
あります。Asahi LinuxはmacOS 12.3/12.4/13.5（モデルやインストール時期によって異なる）のように動作するため、macOS SonomaとAsahi Linuxの
デュアルブートインストールは同じ効果をもたらします。macOS 13.6の場合、この状況はデュアルブートシステムを必要とせず、インストールされている
唯一のOSとしてスタンドアロンで起動することができます。

**Asahi Linuxのインストーラーを更新し、起動時に自動的に整合性チェックとシステム診断を行うようにしました**。実行するには、
以下のコマンドをmacOSのターミナルに貼り付けてください：

`curl https://alx.sh | sh`

メインメニューが表示されたら、システムに変更を加えることなくインストーラーを終了することができます。

アップルのバグレポート FB13319681 および FB13319708 および FB13313702 

## バグは正確には何でしょうか？
バグは2つあります：

* macOS Sonomaのアップグレードでは、以前インストールされていたバージョンをシステムリカバリーとして使用。これはある程度理にかなっているが、
古いRecoveryOSと新しいファームウェアの間の後方互換性の問題を考慮しない。この不一致が原因で、recoveryOSが起動に失敗するとシステムリカバリーが使用不可に

* 14インチおよび16インチモデルの場合： システムファームウェアがmacOS Sonomaバージョンにアップデートされると、ディスプレイがProMotion以外の
リフレッシュレートに設定されている場合、そのシステムは古いmacOSインストールやAsahi Linuxを正しく起動できなくなる。これは、これらのシステムが
デフォルトブートOSとして設定されている場合のリカバリーモードや、*システムリカバリー* を含む\*

\* 特に Asahi Linux は、ちょっと面白いことに、この場合でもログイン画面まで起動しますが、ブートローダ出力（U-Boot / GRUB）が表示されません。
これは、私たちのLinuxディスプレイ・ドライバが、ディスプレイの設定ミスのシナリオから幸運にも回復できるのに対して、macOSドライバは回復できないからです。
それにもかかわらず、ブートピッカー（recoveryOSである）を使ってmacOSに戻ることができないので、困ったことに変わりはありません。

## バグにやられたらどうなりますか？データは失われますか？

DFUモードを使って障害から回復するには、別のMacが必要です。ただし、データは失われません。

## 影響を受ける機種は？

ProMotionディスプレイを搭載したMacBook Proモデル（14インチおよび16インチ）が黒画面ブートバグの影響を受けます。

## 影響を受けるバージョンは？

* ~~macOS Sonoma 14.0+ (2023-10-31時点では修正されていません)~~
* ~~macOS Ventura 13.6+ (14.0 ファームウェアを使用)~~
* ~~macOS Monterey 12.7 (不明、13.6と14.0ファームウェアの報告があるが、念のため影響を受けると仮定)~~

**重要な更新**：標準のソフトウェア・アップデート・プロセスでは、特定のmacOSバージョンを手動でリクエストした場合でも、
常に最新のファームウェア・バージョンにアップグレードされることが判明しました。このため、macOS Sonomaのリリース以降に行われた
**すべての**macOSアップグレードは、ターゲットバージョンに関係なく影響を受けます。旧バージョンをインストールすると、
Sonoma ファームウェアが自動的にダウンロードされます。

## どうすればいいですか？

### まだ macOS Sonoma（または macOS Ventura 13.6）にアップグレードしていません

アップグレードする前に、Appleによってこれらの問題が修正されるまで待つことをお勧めします。14インチまたは16インチのマシンをお持ちで
アップグレードのリスクを冒したい場合は、**アップグレード前にディスプレイのリフレッシュレートがProMotion**に設定されていることを確認してください。
それでもシステムリカバリが壊れてしまうかもしれません。DFUモードで修復するか、続けてアップグレードを成功させるしかありません。

Asahi Linux をインストールするかどうかにかかわらず、Sonoma のアップグレード後に Asahi Linux のインストーラーを実行し、システム
リカバリー・パーティションの状態を確認することをお勧めします。システムに変更が加えられる前に、メインメニューに先立ち、問題があればお知らせします。

**Asahi Linux をインストールする場合**: MacOS 13.5へのアップグレードは安全です。13.5専用のインストーラーをダウンロードするには、
`softwareupdate --fetch-full-installer --full-installer-version 13.5`を実行してください。アップグレードが終わったら、
ディスクスペースを節約するために、インストーラーを削除することを忘れないでください。

### まだmacOS Sonoma（またはmacOS Ventura 13.6）にアップグレードしていません

当面はmacOSバージョン13.5以前のままで結構です。お望みであれば、Asahi Linuxを安全にインストールすることができます。

### すでにmacOS Sonomaにアップグレード済みで、Asahi Linuxをインストールしたいです

Asahi Linux のインストーラがアップデートされ、システムリカバリーのバージョンをチェックするようになり、不整合が存在する場合
リスクをお知らせします。また、ProMotionのリフレッシュレートをチェックし、ProMotionモード以外に設定されている場合はインストールを拒否します。
したがって、この時点ではインストールしても安全です。

インストールプロセスを通常通り開始します。プロンプトに注意深く従い、表示された情報をすべて読んでください。システムリカバリーのバージョンが
不一致の場合、そのリスクを理解していることを確認してください。ディスプレイのリフレッシュレートが正しくない場合、インストーラが変更を要求します。

### すでにmacOS Sonomaにアップグレード済みで、Asahi Linuxを使用しています

現在macOSを起動している場合は、ディスプレイのリフレッシュレートがProMotionに設定されていることを確認してください（14インチおよび16インチマシンの場合）。

Asahi Linuxのインストーラーを再度実行して、System RecoveryOSパーティションの整合性とProMotionの状態を確認することをお勧めします。
問題がある場合は、Appleによって問題が修正されるまで、システムに大きな変更を加えないようにしてください。

### この問題に悩まされています。どうすればいいですか？

機器が黒い画面（短いAppleロゴの後、何も表示されない）で起動する場合は、まず機器の電源を完全に落とし、電源ボタンを押したままにして、
通常のrecoveryOSの起動を試みてください。

それでもうまくいかない場合は、System RecoveryOSで起動してみてください。これを行うには、マシンの電源を完全に落としてから、
電源ボタンを高速で「タップ＆ホールド」するジェスチャーを行います（一度押してから離し、それから押し続けます）。

**更新：Asahi Linuxで立ち往生している場合（上記の手順でmacOSに切り替えるためのブートピッカーにたどり着けないが、代わりに機器が正常にAsahiに
起動する場合）、`asahi-bless` (Fedoraで提供)を使ってLinuxから直接Sonomaに切り替えることで問題を解決できるでしょう**。

それでもうまくいかない場合は、残念ながら DFU モードに頼るしかありません。詳しくは次のセクションを参照してください。

ブートメニューが表示されたら、インストールした macOS Sonoma を選択し、Option を押しながら選択を確定し、デフォルトのブート OS にします。
**代わりに macOS 13.6 ventura をインストールしている場合は、以下の特別セクションに従ってください。**

### DFUモードでマシンを修復するには？

まず、最新バージョンのmacOSが動作する別のMacが必要です（Intel MacでOK）。もう一台のMacにApp StoreからApple Configuratorをインストールし、開きます。

[Appleの指示](https://support.apple.com/ja-jp/guide/apple-configurator-mac/apdd5f3c75ad/2.16/mac/12.4)に従って2台のマシンを接続し、
ターゲットマシンをDFUモードにしてください。この時、ターゲットマシンのディスプレイはオフのままにしてください。

Apple Configuratorに大きな "DFU "アイコンが表示されるはずです。それ以外が表示された場合は、マシンが正しいモードになっていません。
この手順を繰り返し、もう一度試してください。

DFUアイコンが表示されたら、右クリックして『詳細』→『デバイスを復活』を選択します。これで復活プロセスが開始されます。

『このデバイスにはシステムアップデートが必要です』というメッセージが表示されたら、無視して『とにかく復元』を押してください。このプロセスは、
macOS 13.5を実行している別のMacでテスト済みです。

プロンプトに従い、アクセサリーの接続要求をすべて受け入れてください。プロンプトを見逃す可能性があるので、マシンを放置しないでください
（タイムアウトがあります）。処理が完了するまで数分かかります。

復活プロセスが完了すると、マシンはmacOS Recoveryで起動するはずです。プロンプトに従って、本人認証をしてください。

この後、マシンはBoot Pickerに再起動します。

**代わりにmacOS 13.6venturaをお持ちの場合は、以下の特別セクションに従ってください。**

macOS Sonomaを選択し、ディスプレイ設定ページでディスプレイのリフレッシュレートをProMotionに設定します。これで問題の再発を防ぐことができます。

この後、再び『黒画面ブート』になってしまった場合は、前のセクションの手順に従って『タップ＆ホールド』電源ジェスチャーを実行してください。
これでシステム回復OSがアップデートされ、正常に動作するはずです。その後、再びmacOSを選択して、ディスプレイのリフレッシュレートを修正することができます。

### DFUモードを使用するための別のMacがありません！どうすればいいですか？

Mac を アップルストアに持って行き、**DFU 復活** をしてもらうことができます。その際、すべてのデータを消去してしまう復元は**行わないように**してください。
このサービスは無料で行ってくれるはずです。お金を請求されないようにしてください。これはアップルが引き起こした問題であり、純粋にソフトウェアの問題です。
技術者がハードウェアの損傷だと言うなら、それは間違いです。

### もし私がSonomaではなくmacOS 13.6 Venturaを使っていたらどうなりますか？

macOS 13.6 VenturaはmacOS Sonomaシステムファームウェアを使用していますが、この問題の影響を受けます。13.6をシングルブートでインストールしている
ユーザーでさえ、この問題の影響を受けます（Asahi Linuxがなくてもです）。AppleがどのようにしてOSアップデートをリリースしたのか理解できません。
通常通りにアップグレードすると、ディスプレイのリフレッシュレートがデフォルトでない場合、機器を起動不能にします。これはQA上の
重大な見落としがアップル社にあったようです。

お使いのシステムに13.6 Venturaが搭載されていて、黒画面ブート状態に陥ってしまった場合、残念ながら唯一の解決策はSonomaにアップグレードすることです。
ブートピッカーからオプションを選択します。これでrecoveryOSが起動します。そこから 『Install macOS Sonoma』を選択します。画面の指示に従って、
既存のmacOSボリュームを選択します。これでデータを失うことなくmacOSがアップグレードされます。

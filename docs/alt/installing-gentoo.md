---
title: Gentooをインストール
---

2025/3/9時点の[installing-gentoo](https://github.com/AsahiLinux/docs/blob/main/docs/alt/installing-gentoo.md)の翻訳

---
**このページにはディストリビューション固有の情報が含まれています。**
**この文書レポジトリはディストロ固有のドキュメンテーションのための**
**ものではありません。これはディストリビューション独自の文書システムで**
**行うのが適切です。このページは削除される予定です。**

## 目次
- [はじめに](#はじめに)
- [前提](#重要な前提条件)
- [インストール](#手順1-Asahi-U-Boot-環境をセットアップ)
  * [手順1: Asahi U-Boot 環境をセットアップ](#手順1-Asahi-U-Boot-環境をセットアップ)
  * [手順2: Gentoo Asahi LiveCD イメージを入手](#手順2-Gentoo-Asahi-LiveCD-イメージを入手)
  * [手順3: LiveCD にブート](#手順3-LiveCD-にブート)
  * [手順4: Asahiのサポートファイルをインストール](#手順4-asahiのサポートファイルをインストール)
  * [手順5: 楽しんでください！](#手順5-楽しんでください)
- [メンテナンス](#メンテナンス)
  * [U-Bootとm1n1のアップデート](#u-bootとm1n1のアップデート)
  * [カーネルのアップグレード](#カーネルのアップグレード)
  * [Asahi オーバーレイの同期](#asahi-オーバーレイの同期)

## はじめに
Apple SiliconへのGentooのインストールは通常のamd64マシンにインストールするのと差はありません。
Apple Silicon 機器で起動できるようにカスタマイズされている以外標準のGentoo arm64とほとんど同じLiveCDイメージがあります。

ハンドブックからの唯一大きくずれているのは、chadmed氏の[`asahi-gentoos support`](https://github.com/chadmed/asahi-gentoosupport) パッケージを
使用して、カーネル、GRUB、オーバーレイ、m1n1、U-Boot のインストールを自動化したことです。もちろん、手動でインストールすることも可能ですが、
システムの残りの部分を組み合わせてブートストラップするよりも時間がかかるでしょう。

この案内ではAsahi Linux のインストーラに慣れていることを前提にし、インストーラの使い方を説明することはありません。
を使用する手順を説明しません。

Portage オーバーレイを使ったことがない場合は、システムのメンテナンスに関する最後のセクションを何分かかけて読んでください。
これをきちんと行わないと、重要なシステムアップデートを見逃したり、マシンを起動不能な状態に陥らせたりする可能性があります。

## 重要な前提条件
* initramfs のビルドに `genkernel` を使用しないでください。対応 initramfs ジェネレータは `dracut` だけです。
後でインストールする `asahi-configs`  パッケージが `dracut` をシームレスに動作させるために必要な設定ファイルを提供します。

* U-Boot の USB スタックは、控えめに言っても素晴らしいものではありません。さまざまな USB メモリやキーボードが、U-Boot で
きちんと動作しないことがあるかもしれません。残念ながら、今のところこれについてはどうすることもできず、
動作する USB 機器が見つかるまで、いろいろな USB 機器を試してみるしかないでしょう。

## 手順1: Asahi-U-Boot-環境をセットアップ
Asahi インストーラーを使って、最小限の m1n1 + U-boot UEFI 環境をセットアップします。インストーラーに
Gentooシステムに必要な空き容量を残してください。Fedora Asahi Remixの最小インストールオプションを使う方が簡単かもしれません。
今回はそれを使いませんが、ルートファイルシステム用に領域が確保されていることが保証されます。

以後Asahiのインストールが完全に『完了』していることが前提になります。

## 手順2: Gentoo Asahi LiveCD イメージを入手
Apple Silicon 機器で起動できるように少しカスタマイズした Gentoo LiveCD を作っています。最新のものは以下にあります。
https://chadmed.au/pub/gentoo/

LiveCD は標準的な Gentoo リリースエンジニアリングツールを使ってビルドされています。Catalyst の仕様ファイルは以下にあります。
https://github.com/chadmed/gentoo-asahi-releng

お好きな方法で USB メモリにフラッシュしてください。通常は、古い `dd` が一番うまくいくでしょう。

## 手順3: LiveCD にブート
フラッシュした USB メモリを接続した状態でマシンを起動してください。U-Boot は USB 機器を列挙し、自動ブートシーケンスを中断
させるために2秒間与えます。

m1n1 + U-Boot インストールオプションを選択した場合は、そのまま起動を続行させても問題ありません。自動的に USB メモリから起動します。

完全なオペレーティングシステムイメージのいずれかをインストールした場合は、ブートプロセスを中断し、U-Bootを強制的にUSBから
起動させる必要があります。U-Bootの自動ブートシーケンスを中断させたら、以下の一連のコマンドを実行してください:

```
setenv boot_targets "usb"
setenv bootmeths "efi"
boot
```

U-Boot が USB メモリとうまく連携していれば、これでLiveCDのGRUBが起動します。ここからは単純に
Gentoo AMD64 Handbook (訳注: [ハンドブック日本語版](https://wiki.gentoo.org/wiki/Handbook:AMD64/ja) )に従って、
カーネルをインストールする時だけ止めてください。

**注意**： 機器のパーティションを切るときは、rootf s用に確保したスペース以外のパーティションを変更しないことが絶対に重要です。
これには、Asahi インストーラーが設定した EFI システムパーティションも含まれます。rootfs領域は自由にパーティション分割しても
かまいませんが、ディスク上の他の構造は変更しないでください。変更した場合、Mac のDFU 修復が必要になります。

## 手順4: Asahiのサポートファイルをインストール
`emerge -av dev-vcs/git` を実行して Git をマージし、GitHub から `chadmed/asahi-gentoosupport` をcloneしてください。
`./install.sh` を実行し、プロンプトに従ってください。このあとは以下のとおりです:

* カーネル、ブートツール、(おそらく) パッチされたパッケージを提供する Asahi Overlay をインストール
* `sys-apps/asahi-meta` パッケージをインストール。これによりdist-kernel を含む起動に必要な Asahi 固有のいいものすべてが取り込まれる
* GRUBをインストールしアップデート

これによりGRUB、カーネル、ブートツールを自分で設定するのを省くことができます。
このような機器ではGRUBやカーネルやブートツールを自分で設定するのは少し面倒で、起動できない Linux セットアップを残ってしまうかもしれません。

## 手順5: 楽しんでください！
通常のGentooインストール手順の残りを終了し、再起動して、楽しんでください！実行中の設定をArch/Asahi Linuxに基づいて
自分に適合するようにカーネルをカスタマイズするのは良いアイデアです。
実行中のカーネルと initramfs をフォールバックとして保存するのを忘れないでください。
何か問題が起きたときに GRUB から簡単に起動できます。

## メンテナンス
システムアップデートの取得と適用は、完全にバニラなGentooのインストールよりも少し複雑です。
Asahiオーバーレイを同期させ、システムのファームウェアが正しく更新されていることを確認する必要があります。

### U-Bootとm1n1のアップデート
U-Boot や m1n1 パッケージをアップデートすると、Portage は結果のバイナリを `/usr/lib/asahi-boot/` にのみインストールします。
m1n1 には `update-m1n1` というスクリプトが含まれており、カーネルをアップデートするたびに root 権限で実行しなければなりません。
このスクリプトは、カーネル、U-Boot、またはm1n1自体をアップデートするたびに、rootとして実行する必要があります。このスクリプトは、m1n1、
U-Boot、DeviceTreeのブロブを収集し、単一のバイナリオブジェクトにパッケージングし、EFIシステムパーティションに
インストールする役割を担っています。
これがどのように動作するしなぜこのように動作しなければならないのかについての詳細は、 [Apple-Silicon-MacでのオープンOSエコシステム](../platform/open-os-interop.md) を参照してください。

### カーネルのアップグレード
カーネルのアップグレードを実行するときは、Stage 2 の m1n1 ペイロードを同時に更新することが極めて重要となります。
m1n1 Stage 2 には、カーネルがハードウェアを見つけ、適切に調査し、システムを起動するために必要な DeviceTreeブロブが含まれています。
DeviceTreeは安定しておらず、新しいDT(DeviceTree)を含むカーネルのアップグレードは、システムが起動不能になったり、機能が失われたり、
新しく新しく有効になった機能を利用できなくなる可能性があります。このようなことが起こらないようにするために、次のコマンドを実行してください。

```bash
root# update-m1n1
```
をカーネルアップグレード後に*毎回*実行してください。

### Asahi オーバーレイの同期
Asahi 固有のアップデートを受け取るためには、Asahi オーバーレイが同期していることを確認しなければなりません。
Portage は、`emerge --sync` を使用した場合はこれを行いますが、`emerge-webrsync` を使用した場合はこれを行いません。
手動でオーバーレイを同期するために次のコマンドを実行してください。

```bash
root# emaint -r asahi sync
```

をアップデート前に実行してください。パッケージのアップデートを確認するための他の手順は必要ありません。
この時点で通常と同じようにシステムを更新してください。
